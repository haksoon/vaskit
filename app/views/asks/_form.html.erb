<%= render :partial => "common_partial/header_1", :locals => {:title => @ask.id ? "수정하기" : "질문하기" } %>

<p class="chat_bubble">
	고민하고 있는 상황에 대해 설명해주시고,<br />
	제품과 관련된 내용을 상세하게 입력해주세요.
</p>
<div style="background:#f4f4f4; padding:15px 12px 40px; text-align:left;">
	<%= form_for(@ask) do |f| %>
		<div class="content_box" style="padding:10px;">
			<div style="position:relative;">
				<%= f.select :category_id, options_for_select(Category.all.collect {|c| [ c.name, c.id ] }, ["관심사", f.object.category_id]), { include_blank: "관심사를 선택해주세요." }, :class => "category_select" %>
				<span class="input_icon"><i class="fa fa-heart"></i></span>
			</div>
			<div style="position:relative; height:120px;">
				<%= f.text_area :message, :placeholder => "고민하고 있는 상황을 알려주세요! #해시태그도 자유롭게 활용해보세요.", :class => "ask_message_input" %>
				<span class="input_icon" onclick="$('#ask_message').focus(); return false;" style="height: 120px; line-height: 120px;"><i class="fa fa-slack" style="transform:rotateY(180deg) skewY(18deg);"></i></span>
			</div>
		</div>


		<div class="content_box" style="padding:10px;">
			<div style="position:relative;">
				<a class="ask_search_deal" href="#" onclick="show_search_deal_popup(true); return false;">
					<i class="fa fa-search" style="color:#ee6e01;"></i>&nbsp;CARD A 검색하기
				</a>
				<span id="card_a_overlay_open" class="input_icon right_input" onclick="<% if @ask.id %> hide_card_overlay(true); <% else %> show_card_overlay(true); <% end %> return false;" style="width: 44px; height: 44px; line-height: 44px; border-right-width: 3px; border-bottom-width: 3px; border-radius: 5px; background-color: #fff; padding-left: 2px; cursor:pointer;">
				  <i class="fa <% if @ask.id %> fa-angle-up <% else %> fa-angle-down <% end %>"></i>
				</span>
			</div>
			<div id="card_a_overlay" style="padding-top:10px; <% if @ask.id %> display:block; <% else %> display:none; <% end %>">
				<a id="left_deal_image_btn" href="#" onclick="left_deal_image_upload(); return false;" style="display:block; border:1px solid #dbdbdb; margin-bottom:10px;">
					<img src="<%= @left_ask_deal && @left_ask_deal.image ? @left_ask_deal.image.url(:normal) : "/images/ask/card_a_upload.png" %>" style="display:block; margin:0 auto; width:100%;">
				</a>
				<div style="position:relative; margin-bottom:10px;">
					<%= text_area_tag 'left_deal[title]', @left_ask_deal && @left_ask_deal.title ? @left_ask_deal.title : nil, :placeholder => "제품명", :class => "ask_text_field", :rows => 1 %>
					<span class="input_icon" onclick="$('#left_deal_title').focus(); return false;"><i class="fa fa-cube"></i></span>
				</div>
				<div style="position:relative; margin-bottom:10px;">
					<%= text_area_tag 'left_deal[brand]', @left_ask_deal && @left_ask_deal.brand ? @left_ask_deal.brand : nil, :placeholder => "브랜드", :class => "ask_text_field", :rows => 1 %>
					<span class="input_icon" onclick="$('#left_deal_brand').focus(); return false;"><i class="fa fa-tag"></i></span>
				</div>
				<div style="position:relative; margin-bottom:10px;">
					<%= number_field_tag 'left_deal[price]', @left_ask_deal && @left_ask_deal.price ? @left_ask_deal.price : nil, :placeholder => "판매가격", :class => "ask_text_field" %>
					<span class="input_icon" onclick="$('#left_deal_price').focus(); return false;"><i class="fa fa-won"></i></span>
				</div>
				<div style="position:relative; margin-bottom:10px;">
					<%= text_area_tag 'left_deal[link]', @left_ask_deal && @left_ask_deal.link ? @left_ask_deal.link : nil, :placeholder => "링크", :class => "ask_text_field", :rows => 1 %>
					<span class="input_icon" onclick="$('#left_deal_link').focus(); return false;"><i class="fa fa-link"></i></span>
				</div>
				<div style="position:relative; margin-bottom:10px; color:#9d9ea1; text-align:center; height:16px;">
	  			<i class="fa fa-plus"></i>
				</div>
				<div style="position:relative; margin-bottom:10px;">
					<%= text_area_tag 'left_deal[spec1]', @left_ask_deal && @left_ask_deal.spec1 ? @left_ask_deal.spec1 : nil, :placeholder => "추가 스펙1", :class => "ask_text_field", :rows => 1 %>
					<span class="input_icon" onclick="$('#left_deal_spec1').focus(); return false;"><i class="fa fa-plus-circle"></i></span>
				</div>
				<div style="position:relative; margin-bottom:10px;">
					<%= text_area_tag 'left_deal[spec2]', @left_ask_deal && @left_ask_deal.spec2 ? @left_ask_deal.spec2 : nil, :placeholder => "추가 스펙2", :class => "ask_text_field", :rows => 1 %>
					<span class="input_icon" onclick="$('#left_deal_spec2').focus(); return false;"><i class="fa fa-plus-circle"></i></span>
				</div>
				<div style="position:relative;">
					<%= text_area_tag 'left_deal[spec3]', @left_ask_deal && @left_ask_deal.spec3 ? @left_ask_deal.spec3 : nil, :placeholder => "추가 스펙3", :class => "ask_text_field", :rows => 1 %>
					<span class="input_icon" onclick="$('#left_deal_spec3').focus(); return false;"><i class="fa fa-plus-circle"></i></span>
				</div>
			</div>
		</div>

		<div class="content_box" style="padding:10px;">
			<div style="position:relative;">
				<a class="ask_search_deal" href="#" onclick="show_search_deal_popup(false); return false;">
					<i class="fa fa-search" style="color:#ee6e01;"></i>&nbsp;CARD B 검색하기
				</a>
				<span id="card_b_overlay_open" class="input_icon right_input" onclick="<% if @ask.id %> hide_card_overlay(false); <% else %> show_card_overlay(false); <% end %> return false;" style="width: 44px; height: 44px; line-height: 44px; border-right-width: 3px; border-bottom-width: 3px; border-radius: 5px; background-color: #fff; padding-left: 2px; cursor:pointer;">
					<i class="fa <% if @ask.id %> fa-angle-up <% else %> fa-angle-down <% end %>"></i>
				</span>
			</div>
			<div id="card_b_overlay" style="padding-top:10px; <% if @ask.id %> display:block; <% else %> display:none; <% end %>">
				<a id="right_deal_image_btn" href="#" onclick="right_deal_image_upload(); return false;" style="display:block; border:1px solid #dbdbdb; margin-bottom:10px;">
					<img src="<%= @right_ask_deal && @right_ask_deal.image ? @right_ask_deal.image.url(:normal) : "/images/ask/card_b_upload.png" %>" style="display:block; margin:0 auto; width:100%;">
				</a>
				<div style="position:relative; margin-bottom:10px;">
					<%= text_area_tag 'right_deal[title]', @right_ask_deal && @right_ask_deal.title ? @right_ask_deal.title : nil, :placeholder => "제품명", :class => "ask_text_field right_input", :rows => 1 %>
					<span class="input_icon right_input" onclick="$('#right_deal_title').focus(); return false;"><i class="fa fa-cube"></i></span>
				</div>
				<div style="position:relative; margin-bottom:10px;">
					<%= text_area_tag 'right_deal[brand]', @right_ask_deal && @right_ask_deal.brand ? @right_ask_deal.brand : nil, :placeholder => "브랜드", :class => "ask_text_field right_input", :rows => 1 %>
					<span class="input_icon right_input" onclick="$('#right_deal_brand').focus(); return false;"><i class="fa fa-tag"></i></span>
				</div>
				<div style="position:relative; margin-bottom:10px;">
					<%= number_field_tag 'right_deal[price]', @right_ask_deal && @right_ask_deal.price ? @right_ask_deal.price : nil, :placeholder => "판매가격", :class => "ask_text_field right_input" %>
					<span class="input_icon right_input" onclick="$('#right_deal_price').focus(); return false;"><i class="fa fa-won"></i></span>
				</div>
				<div style="position:relative; margin-bottom:10px;">
					<%= text_area_tag 'right_deal[link]', @right_ask_deal && @right_ask_deal.link ? @right_ask_deal.link : nil, :placeholder => "링크", :class => "ask_text_field right_input", :rows => 1 %>
					<span class="input_icon right_input" onclick="$('#right_deal_link').focus(); return false;"><i class="fa fa-link"></i></span>
				</div>
				<div style="position:relative; margin-bottom:10px; color:#9d9ea1; text-align:center; height:16px;">
	  			<i class="fa fa-plus"></i>
				</div>
				<div style="position:relative; margin-bottom:10px;">
					<%= text_area_tag 'right_deal[spec1]', @right_ask_deal && @right_ask_deal.spec1 ? @right_ask_deal.spec1 : nil, :placeholder => "추가 스펙1", :class => "ask_text_field right_input", :rows => 1 %>
					<span class="input_icon right_input" onclick="$('#right_deal_spec1').focus(); return false;"><i class="fa fa-plus-circle"></i></span>
				</div>
				<div style="position:relative; margin-bottom:10px;">
					<%= text_area_tag 'right_deal[spec2]', @right_ask_deal && @right_ask_deal.spec2 ? @right_ask_deal.spec2 : nil, :placeholder => "추가 스펙2", :class => "ask_text_field right_input", :rows => 1 %>
					<span class="input_icon right_input" onclick="$('#right_deal_spec2').focus(); return false;"><i class="fa fa-plus-circle"></i></span>
				</div>
				<div style="position:relative;">
					<%= text_area_tag 'right_deal[spec3]', @right_ask_deal && @right_ask_deal.spec3 ? @right_ask_deal.spec3 : nil, :placeholder => "추가 스펙3", :class => "ask_text_field right_input", :rows => 1 %>
					<span class="input_icon right_input" onclick="$('#right_deal_spec3').focus(); return false;"><i class="fa fa-plus-circle"></i></span>
				</div>
			</div>
		</div>

		<div style="display:none;">
			<div style="margin:0 2px 0 2px; font-size:13px; color:#383838;">
				<%= f.text_field :spec1, :placeholder => "추가 스펙명", :class => "ask_text_field center_input" %>
			</div>
			<div style="margin:0 2px 0 2px; font-size:13px; color:#383838;">
				<%= f.text_field :spec2, :placeholder => "추가 스펙명", :class => "ask_text_field center_input" %>
			</div>
			<div style="margin:0 2px 0 2px; font-size:13px; color:#383838;">
				<%= f.text_field :spec3, :placeholder => "추가 스펙명", :class => "ask_text_field center_input" %>
			</div>
		</div>

		<div style="display:none;">
			<%= file_field_tag 'left_deal[image]', :accept => 'image/*', :multiple => false, :style => "visibility:hidden; width:1px; display:inline;" %>
			<%= hidden_field_tag 'left_deal[image_id]' %>

			<%= file_field_tag 'right_deal[image]', :accept => 'image/*', :multiple => false, :style => "visibility:hidden; width:1px; display:inline;" %>
			<%= hidden_field_tag 'right_deal[image_id]' %>

			<%= hidden_field_tag 'left_deal[deal_id]' %>
			<%= hidden_field_tag 'right_deal[deal_id]' %>
		</div>
	<% end %>
</div>
<div style="position:fixed; bottom:0; width:inherit; box-sizing:border-box; z-index:1;">
	<% if @ask.id %>
		<a href="#" onclick="edit_form(); return false;" class="ask_submit_btn">
			<i class="fa fa-plus-circle"></i>&nbsp;질문 수정하기
		</a>
	<% else %>
		<a href="#" onclick="submit_form(); return false;" class="ask_submit_btn">
			<i class="fa fa-plus-circle"></i>&nbsp;질문 제출하기
		</a>
	<% end %>
</div>

<div id="search_deal_popup_bg" href="#" onclick="hide_search_deal_popup(); return false;" style="display:block; position:fixed;left:0; top:0; width:100%; height:100%; background-color:black; z-index:12; opacity:0.6; display:none;"></div>
<div id='search_deal_popup' style='width:inherit; z-index:13; position:fixed; top:30px; display:none;'>
	<div style="padding:10px;">
		<div>
			<a href="#" onclick="hide_search_deal_popup(); return false;" style="position:absolute;right: 10px;top: 10px;width: 40px;height: 40px;text-align: center;"><i class="fa fa-times" style="color: #fff; font-size: 20px; padding-top: 10px;"></i></a>
			<p id="search_deal_title" style="background-color:#4b3d3d; font-size:15px; color:#FFF; height:40px; line-height:40px; margin:0;">
				CARD A 검색해서 입력하기
			</p>
			<div style="background-color:#f4f4f4; padding:10px 14px;">
				<table cellspacing="0" cellpadding="0" style="width:100%; background-color:#fff;">
					<tr>
						<td style="width:100%;">
							<input id="deal_search_keyword" type="text" class="comment_box" placeholder="제품명을 입력해주세요." />
						</td>
						<td>
							<a id="deal_search_btn" href="#" style="width:50px; height:40px; line-height:40px; background-color:#dbdbdb; display:inline-block; color:#fff; font-size:13px;">입력</a>
						</td>
					</tr>
				</table>
				<div id="search_deal_result" style="display:none;">
					<table cellspacing="0" cellpadding="0" style="width:100%; background-color:#fff; border-top:1px solid #3b3d3d; border-left:1px solid #dbdbdb; border-right:1px solid #dbdbdb; margin-top:10px;">
						<tr>
							<td style="width:50%;">
								<a id="naver_deals_btn" href="#" onclick="show_naver_deals(); return false;" style="font-size:14px; color:#383838; line-height:38px; display:block; background-color:#fff; ">
									쇼핑 검색결과
								</a>
							</td>
							<td style="width:50%;">
								<a id="naver_images_btn" href="#"  onclick="show_naver_images(); return false;" style="font-size:14px; color:#383838; line-height:38px; display:block; border-bottom:1px solid #dbdbdb; border-left:1px solid #dbdbdb;  background-color:#f4f4f4;">
									이미지 검색결과
								</a>
							</td>
						</tr>
					</table>
					<div id="search_result_div" style="background-color:#fff; border:1px solid #dbdbdb; border-top:none; overflow-y:auto; min-height:150px; max-height:340px;">
						<div id="naver_deals"></div>
						<div id="naver_images" style="display:none;"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/template" id="naver-deal-template">
	<table cellspacing="0" cellpadding="0" style="width:100%;">
		{{ for(var i=0; i < items.length; i++) { }}
			{{ var item = items[i] }}
			<tr>
				<td class="hover_pointer" onclick="select_deal('{{= item.productId }}', {{= is_left }}); return false;" style="width:80px; height:80px; padding:4px 12px; border-bottom:1px solid #dbdbdb;">
					<img src="{{= item.image }}" style="width:80px; height:80px; display:block;" />
				</td>
				<td class="hover_pointer" onclick="select_deal('{{= item.productId }}', {{= is_left }}); return false;" style="border-bottom:1px solid #dbdbdb; text-align:left;">
					<p style="font-size:12px; font-weight:bold; margin:0; color:#383838;">{{= truncate(item.title) }}</p>
					<p style="font-size:12px; margin:0; color:#ee6e01;">{{= numberWithCommas(item.lprice) }}원</p>
					<p style="font-size:11px; margin:0; color:#383838;">{{= item.mallName }}</p>
				</td>
			</tr>
		{{ } }}
	</table>
</script>

<script type="text/template" id="naver-image-template">
	<div style="padding:6px 10px;">
		<table cellspacing="0" cellpadding="0" style="width:100%;">
			{{ for(var i=0; i < Math.ceil(image_items.length/3); i++) { }}
				<tr>
					{{ var item1 = image_items[i * 3] }}
					<td style="width:33.3%; padding:6px 3px;">
						<a href="#" onclick="select_image('{{= item1.thumbnail }}', {{= is_left }}); return false;" class="naver_image_wrap">
							<div class="naver_image_content" style="background:url('{{= item1.thumbnail }}') no-repeat 100% 100%; background-size:100% 100%;"></div>
						</a>
					</td>
					{{ var item2 = image_items[i * 3 + 1] }}
					<td style="width:33.3%; padding:6px 3px;">
						{{ if (item2 != null){ }}
						<a href="#" onclick="select_image('{{= item2.thumbnail }}', {{= is_left }}); return false;" class="naver_image_wrap">
							<div class="naver_image_content" style="background:url('{{= item2.thumbnail }}') no-repeat 100% 100%; background-size:100% 100%;"></div>
						</a>
						{{ } }}
					</td>
					{{ var item3 = image_items[i * 3 + 2] }}
					<td style="width:33.3%; padding:6px 3px;">
						{{ if (item3 != null){ }}
						<a href="#" onclick="select_image('{{= item3.thumbnail }}', {{= is_left }}); return false;" class="naver_image_wrap">
							<div class="naver_image_content" style="background:url('{{= item3.thumbnail }}') no-repeat 100% 100%; background-size:100% 100%;"></div>
						</a>
						{{ } }}
					</td>
				</tr>
			{{ } }}
		</table>
	</div>
</script>


<script>

	var items;
	var image_items;

	function deal_search_by_key(){
		var deal_search_keyword = $('#deal_search_keyword').val();
		if(deal_search_keyword == "" || deal_search_keyword == undefined){
			notify("제품명을 입력해주세요.");
		}else{
			$("#deal_search_btn").click();
		}
	}

	$('#deal_search_keyword').keypress(function(e) {
		$("#deal_search_btn").css("background-color","#ee6e01");
		if (e.keyCode == '13') {
        	e.preventDefault();
        	deal_search_by_key();
      	}
	});

	function show_card_overlay(is_left) {
		if (is_left) {
			$("#card_a_overlay").slideDown(500, function(){
				$("#card_a_overlay_open").children("i").removeClass("fa-angle-down").addClass("fa-angle-up");
				$("#card_a_overlay_open").attr("onclick","hide_card_overlay(true); return false;");
				var top = $("#card_a_overlay").offset().top;
				$("body").animate({scrollTop:top-110},500);
			});
		} else {
			$("#card_b_overlay").slideDown(500, function(){
				$("#card_b_overlay_open").children("i").removeClass("fa-angle-down").addClass("fa-angle-up");
				$("#card_b_overlay_open").attr("onclick","hide_card_overlay(false); return false;");
				var top = $("#card_b_overlay").offset().top;
				$("body").animate({scrollTop:top-110},500);
			});
		}
	}

	function hide_card_overlay(is_left) {
		if (is_left) {
			$("#card_a_overlay").slideUp(500, function(){
				$("#card_a_overlay_open").children("i").removeClass("fa-angle-up").addClass("fa-angle-down");
				$("#card_a_overlay_open").attr("onclick","show_card_overlay(true); return false;");
			});
		} else {
			$("#card_b_overlay").slideUp(500, function(){
				$("#card_b_overlay_open").children("i").removeClass("fa-angle-up").addClass("fa-angle-down");
				$("#card_b_overlay_open").attr("onclick","show_card_overlay(false); return false;");
			});
		}
	}

	function hide_search_deal_popup(){
		$("#search_deal_popup").hide();
		$("#search_deal_popup_bg").hide();
		$("#search_deal_result").hide();
		$("#deal_search_keyword").val("");
		$("#naver_deals").html("");
		$("#naver_images").html("");
		$("#deal_search_btn").attr("onclick","");
	}

	function show_search_deal_popup(is_left){
		$("#search_deal_popup_bg").show();
		$("#search_deal_popup").show();
		$("#deal_search_keyword").focus().select();
		$("#deal_search_btn").attr("onclick", "deal_search("+is_left+"); return false;");
		if (is_left){
			$("#search_deal_title").html("CARD A 검색해서 입력하기");
			show_card_overlay(true);
		} else {
			$("#search_deal_title").html("CARD B 검색해서 입력하기");
			show_card_overlay(false);
		}
	}

	function show_naver_deals(){
		$("#search_result_div").scrollTop(0);
		$("#naver_deals").show();
		$("#naver_images").hide();
		$("#naver_images_btn").css("border-bottom","1px solid #dbdbdb");
		$("#naver_images_btn").css("border-left","1px solid #dbdbdb");
		$("#naver_images_btn").css("background-color","#f4f4f4");
		$("#naver_deals_btn").css("border-bottom","none");
		$("#naver_deals_btn").css("border-right","none");
		$("#naver_deals_btn").css("background-color","#fff");
	}

	function show_naver_images(){
		$("#search_result_div").scrollTop(0);
		$("#naver_deals").hide();
		$("#naver_images").show();
		$("#naver_deals_btn").css("border-bottom","1px solid #dbdbdb");
		$("#naver_deals_btn").css("border-right","1px solid #dbdbdb");
		$("#naver_deals_btn").css("background-color","#f4f4f4");
		$("#naver_images_btn").css("border-bottom","none");
		$("#naver_images_btn").css("border-left","none");
		$("#naver_images_btn").css("background-color","#fff");
	}

	function deal_search(is_left){
		var keyword = $("#deal_search_keyword").val();
		$.ajax({
	        url: '/deals/get_naver_deals/?keyword='+encodeURIComponent(keyword),
	        type: 'GET',
	        error: function(){
	            return false;
	        },
	        success: function(data){
	        	$("#search_deal_result").show();
	        	image_items = data.image_result.rss.channel.item;
			      if (image_items != null ){
		        	var naverImageTemplate = _.template( $('#naver-image-template').html() );
				    $('#naver_images').html(naverImageTemplate({image_items: image_items, is_left: is_left}));
	        	}else{
	        		$('#naver_images').html("<p style='line-height:150px; color:#383838;'>이미지 검색결과가 없습니다.</p>");
	        	}

	        	items = data.shop_result.rss.channel.item;
	        	if (items != null ){
		        	var naverDealTemplate = _.template( $('#naver-deal-template').html() );
				    $('#naver_deals').html( naverDealTemplate({item: items, is_left: is_left}) );
	        	}else{
	        		$('#naver_deals').html("<p style='line-height:150px; color:#383838;'>상품 검색결과가 없습니다.</p>");
	        	}
	        	show_naver_deals();
	        },
	        beforeSend: function(){
	        	$(".loading").show();
            },
            complete: function(){
            	$(".loading").hide();
            }
		});
	}

	function select_deal(product_id, is_left){
		item = $.grep(items, function(obj) { return obj.productId === product_id; })[0];

		$.ajax({
	        url: '/deals/create_by_naver.json',
	        type: 'POST',
	        data: {item: item},
	        error: function(){
	            return false;
	        },
	        success: function(data){
	        	deal = data.deal;
	        	if (is_left){
	        		$("#left_deal_image_btn img").attr("src", get_image_url(deal, "deals", "normal") );
	        		$("#left_deal_title").val(deal.title);
	        		$("#left_deal_brand").val(deal.brand);
	        		$("#left_deal_price").val(deal.price);
	        		$("#left_deal_link").val(deal.link);
	        		$("#left_deal_deal_id").val(deal.id);

	        		$("#left_deal_image_id").val("");
	        	}else{
	        		$("#right_deal_image_btn img").attr("src", get_image_url(deal, "deals", "normal") );
	        		$("#right_deal_title").val(deal.title);
	        		$("#right_deal_brand").val(deal.brand);
	        		$("#right_deal_price").val(deal.price);
	        		$("#right_deal_link").val(deal.link);
	        		$("#right_deal_deal_id").val(deal.id);

	        		$("#right_deal_image_id").val("");
	        	}
	        	$("#naver_images").html("");
	        	$("#naver_deals").html("");
	        	hide_search_deal_popup();
					},
					beforeSend: function(){
						$(".loading").show();
					},
					complete: function(){
						$(".loading").hide();
					}
		});
	}

	function select_image(image_url, is_left){
		$.ajax({
	        url: '/preview_images/create_by_naver.json',
	        type: 'POST',
	        data: {image_url: image_url},
	        error: function(){
	            return false;
	        },
	        success: function(data){
	        	if (is_left){
	        		$("#left_deal_image_btn img").attr("src", data.image_url );
	        		$("#left_deal_image_id").val(data.id);
	        		// $("#left_deal_title").val(null);
	        		// $("#left_deal_brand").val(null);
	        		// $("#left_deal_price").val(null);
	        	} else {
	        		$("#right_deal_image_btn img").attr("src", data.image_url );
	        		$("#right_deal_image_id").val(data.id);
	        		// $("#right_deal_title").val(null);
	        		// $("#right_deal_brand").val(null);
	        		// $("#right_deal_price").val(null);
	        	}
	        	$("#naver_images").html("");
	        	$("#naver_deals").html("");
	        	hide_search_deal_popup();
					},
	        beforeSend: function(){
						$(".loading").show();
					},
					complete: function(){
						$(".loading").hide();
					}
		});
	}

	function left_deal_image_upload(){
		$("#left_deal_image").click();
	}

	$("#left_deal_image").change(function(){
		$.each( $("#left_deal_image")[0].files, function( i, file ) {
			var formData = new FormData();
		    formData.append('File', file);

		    $.ajax({
		       type: "POST",
		       url: "/preview_images.json",
		       data: formData,
		       contentType: false,
		       processData: false,
		       success: function (data) {
						 $("#left_deal_image_btn img").attr("src",data.image_url);
						 $("#left_deal_image_id").val(data.id);
		       },
					 beforeSend: function(){
						 $(".loading").show();
					 },
					 complete: function(){
						 $(".loading").hide();
					 }
		    }).fail(function (data) {}).done(function () {});
		});
	});


	function right_deal_image_upload(){
		$("#right_deal_image").click();
	}

	$("#right_deal_image").change(function(){
		$.each( $("#right_deal_image")[0].files, function( i, file ) {
			var formData = new FormData();
		    formData.append('File', file);

		    $.ajax({
		       type: "POST",
		       url: "/preview_images.json",
		       data: formData,
		       contentType: false,
		       processData: false,
		       success: function (data) {
						 $("#right_deal_image_btn img").attr("src",data.image_url);
						 $("#right_deal_image_id").val(data.id);
		       },
			  	 beforeSend: function(){
						 $(".loading").show();
           },
           complete: function(){
						 $(".loading").hide();
           }
		    }).fail(function (data) {}).done(function () {});
		});
	});

	var check_click = 0;

	function submit_form(){
		if ( $("#left_deal_image_btn img").attr("src") == "/images/ask/card_a_upload.png"){
			notify('CARD A 이미지를 추가해주세요.');
			return;
		}

		if ( $("#left_deal_title").val() == "" || $("#left_deal_title").val() == null ){
			notify('CARD A 제품명을 입력해주세요.');
			return;
		}

		if ( $("#right_deal_image_btn img").attr("src") == "/images/ask/card_b_upload.png"){
			notify('CARD B 이미지를 추가해주세요.');
			return;
		}

		if ( $("#right_deal_title").val() == "" || $("#right_deal_title").val() == null ){
			notify('CARD B 제품명을 입력해주세요.');
			return;
		}
		if (check_click == 0) {
			var left_price = $("#left_deal_price").val();
			var right_price = $("#right_deal_price").val();
			$("#left_deal_price").val(uncomma(left_price));
			$("#right_deal_price").val(uncomma(right_price));
			$("#new_ask").submit();
			check_click = check_click + 1;
		} else {
			return;
		}
	}

	function edit_form(){

		if ( $("#left_deal_title").val() == "" || $("#left_deal_title").val() == null ){
			notify('CARD A 제품명을 입력해주세요.');
			return;
		}

		if ( $("#right_deal_title").val() == "" || $("#right_deal_title").val() == null ){
			notify('CARD B 제품명을 입력해주세요.');
			return;
		}
		var left_price = $("#left_deal_price").val();
		var right_price = $("#right_deal_price").val();
		$("#left_deal_price").val(uncomma(left_price));
		$("#right_deal_price").val(uncomma(right_price));
		$(".edit_ask").submit();
	}

  //
  $(window).bind('beforeunload', function(){
      return "게시글 작성을 중단하시겠습니까?";
  });

  $(document).on("submit", "form", function(event){
      $(window).off('beforeunload');
  });
	//

	//콤마찍기
	function comma(str) {
    str = String(str);
    return str.replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
	}
	function uncomma(str) {
	    str = String(str);
	    return str.replace(/[^\d]+/g, '');
	}
	function inputNumberFormat(obj) {
	    obj.value = comma(uncomma(obj.value));
	}

	$("#left_deal_price").attr("type","text");
	$("#right_deal_price").attr("type","text");
	$("#left_deal_price").attr("onkeyup","inputNumberFormat(this)");
	$("#right_deal_price").attr("onkeyup","inputNumberFormat(this)");


</script>
