<div id="user_overlay">
	<% if current_user %>
		<div style="position:absolute; top:-55px; right:0; width:60px; height:50px; background-color:#4b3d3d; text-align:center;">
			<a href="#" onclick="user_off(); return false;" style="display:block; box-sizing:border-box; width:60px; height:50px; padding-right:10px;">
				<i class="fa fa-remove" style="color: #fff; font-size: 26px; padding-top: 11px;"></i>
			</a>
		</div>
		<div style="position:absolute; top:-10px; right:28px; border-bottom:10px solid #998674; border-right:7px solid transparent; border-left:7px solid transparent;"></div>
		<div style="box-sizing:border-box; width:100%; background-color:#f4f4f4; border:3px solid #998674; border-radius:5px; overflow:hidden;">
			<p style="margin:0; height:40px; line-height:40px; font-size:16px; font-weight:bold; color:#fff; background-color:#998674; text-align:center;">마이 페이지</p>
			<div style="padding:20px;">
				<p style="margin:0; margin-bottom:16px; padding:0 10px; color:#666; text-align:center;">
					<span style="color:#998674;"><%= current_user.string_id %></span>님, 환영합니다!
					<a href="/users/manage" style="float:right;"><i class="fa fa-gear" style="color: #9d9ea1; font-size: 20px;"></i></a>
				</p>
				<div style="width:100%; background:#998675; text-align:center; color:#fff; font-size:14px; line-height:40px; position:relative; border-radius:5px 5px 0 0;">
					히스토리
				</div>
				<table cellspacing="0" cellpadding="0" style="border:1px solid #dbdbdb; border-top:none; width:100%; text-align:center; background-color:#fff; border-radius:0 0 5px 5px;">
					<tr>
						<td style="width:5%;"></td>
						<td style="width:30%; padding:10px 0;">
							<a id="my_ask_count" href="/?type=my_ask" style="display:block; color:#383838; font-size:22px; line-height:24px; margin:0;"><%= @my_ask_count %></a>
							<a href="/?type=my_ask" style="display:block; color:#9e9fa1; font-size:12px; line-height:12px; margin:0;">Asks</a>
						</td>
						<td style="width:30%;">
							<a id="my_vote_count" href="/?type=vote_ask" style="display:block; color:#383838; font-size:22px; line-height:24px; margin:0;"><%= @my_vote_count %></a>
							<a href="/?type=vote_ask" style="display:block; color:#9e9fa1; font-size:12px; line-height:12px; margin:0;">Votes</a>
						</td>
						<td style="width:30%;">
							<a id="my_comment_count" href="/?type=comment_ask" style="display:block; color:#383838; font-size:22px; line-height:24px; margin:0;"><%= @my_comment_count %></a>
							<a href="/?type=comment_ask" style="display:block; color:#9e9fa1; font-size:12px; line-height:12px; margin:0;">Comments</a>
						</td>
						<td style="width:5%;"></td>
					</tr>
				</table>

				<a href="/?type=my_ask_in_progress" style="display:block; width:100%; background:#998675; text-align:center; color:#fff; font-size:14px; line-height:40px; position:relative; margin-top:16px; border-radius:5px;">
					진행 중인 질문 (<span id="in_progress_count"><%= @in_progress_count%></span>개)
				</a>

				<a href="/alrams" style="display:block; width:100%; background:#998675; text-align:center; color:#fff; font-size:14px; line-height:40px; position:relative; margin-top:16px; border-radius:5px;">
					<% unless Alram.where(:user_id => current_user.id, :is_read => false).blank? %>
					<img src="/images/header/new.png" style="position:relative; top:3px; width:16px;"/>
					<% end %>
					알림피드 (<%= @alram_count > 15 ? "15+": @alram_count.to_s %>개)
				</a>
			</div>
		</div>
	<% end %>
</div>

<script>
	var my_ask_count = <%= raw @my_ask_count.to_json %>;
	var my_vote_count = <%= raw @my_vote_count.to_json %>;
	var my_comment_count = <%= raw @my_comment_count.to_json %>;
	var in_progress_count = <%= raw @in_progress_count.to_json %>;
	// 알람 카운트는 메커니즘이 좀 달라서 추후에 보완

	<% if flash[:custom_notice] %>
		notify('<%=flash[:custom_notice]%>');
	<% end %>

	function user_on(){
		$("#user_overlay").fadeIn(100);
		$("#footer").show().animate({"bottom":"-1px"},200);
		$("#menu_pc_bg").show();
		$("#menu_bg").fadeIn(100);
		$("#my_ask_count").text(my_ask_count);
		$("#my_vote_count").text(my_vote_count);
		$("#my_comment_count").text(my_comment_count);
		$("#in_progress_count").text(in_progress_count);

		$("#category_overlay").hide();
		$("#search_overlay").hide();
		$('#search_input').val("");
		$("#keyword_reset_btn").hide();
	}

	function user_off(){
		$("#user_overlay").fadeOut(300);
		$("#footer").animate({"bottom":"-100%"},300,function(){$(this).hide();});
		$("#menu_pc_bg").hide();
		$("#menu_bg").fadeOut(300);
	}

</script>
