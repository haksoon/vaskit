<div id="ask_image_bg" onclick="ask_image_off(); return false;" style="position:fixed; top:0; left:0; width:100%; height:100%; cursor:pointer; background-color:#000; z-index:12; opacity:0.75; display:none;"></div>
<div id="ask_image_overlay" style="position:fixed; top:0; width:inherit; height:100%; display:table; z-index:13; display:none;">
  <a href="#" onclick="ask_image_off(); return false;" style="position:fixed; top:0; left:0; width:100%; height:100%; display:block; text-align:right; cursor:default;"></a>
  <div style="display:table; width:100%; height:100%;">
    <div style="display:table-cell; text-align:center; vertical-align:middle;">
      <div id="ask_image_seg" style="padding:12px; display:inline-block; height:initial; overflow:auto;"></div>
    </div>
  </div>
</div>

<script type="text/template" id="ask-image-seg-template">
  <div id="ask_image_box">
    <div style="text-align:right;">
      <span style="display:inline-block; color:#fff; font-size:40px; width:40px; height:40px; text-align:center;">&times;</span>
    </div>
    {{ if (is_left){ }}
      {{ ask_deal = ask.left_ask_deal }}
      {{ left_css = "background-color:#f4f4f4; color:#ee6e01; font-weight:bold;" }}
      {{ right_css = "background-color:#9d9ea1; color:#fff; font-weight:normal;" }}
    {{ } else { }}
      {{ ask_deal = ask.right_ask_deal }}
      {{ left_css = "background-color:#9d9ea1; color:#fff; font-weight:normal;" }}
      {{ right_css = "background-color:#f4f4f4; color:#ee6e01; font-weight:bold;" }}
    {{ } }}
    <div class="table_div" style="margin-bottom:0;">
      <a href="#" onclick="ask_image_on({{=ask.id}}, true); return false;" style="float:left; width:50%; display:block; font-size:14px; height:40px; line-height:40px; border-radius:10px 0 0 0; {{= left_css }} ">CARD A</a>
      <a href="#" onclick="ask_image_on({{=ask.id}}, false); return false;" style="float:right; width:50%; display:block; font-size:14px; height:40px; line-height:40px; border-radius:0 10px 0 0; {{= right_css }}">CARD B</a>
    </div>
    <img src='{{= get_image_url(ask_deal, "ask_deals", "normal") }}' style="width:100%; display:block;" />
    <div class="table_div" style="padding:10px; border-radius:0 0 10px 10px; font-size:13px; color:#666; background-color:#f4f4f4;">
      {{ if (ask_deal.title != ""){ }}
        <p style="margin:5px auto; font-weight:bold;">{{= ask_deal.title }}</p>
      {{ } }}
			{{ if (ask_deal.brand != ""){ }}
        <p style="margin:5px auto; font-weight:normal;">{{= ask_deal.brand }}</p>
      {{ } }}
			{{ if (ask_deal.price != null){ }}
        <p style="margin:5px auto; font-weight:normal;">{{= numberWithCommas(ask_deal.price) }}원</p>
      {{ } }}
      {{ if (ask_deal.link != ""){ }}
        {{ var aLink = document.createElement("a") }}
        {{ aLink.href= ask_deal.link }}
        <a href="{{=ask_deal.link }}" target="_blank" style="color:#ee6e01; margin:5px auto; display:block;"><i class="fa fa-external-link" style="color: #ee6e01; font-size: 12px; font-weight: bold;"></i>&nbsp;{{= aLink.host }}</a>
      {{ } }}
    </div>
  </div>
</script>

<script>
  function ask_image_on(ask_id, is_left){
    disableScroll();
    $("#ask_image_overlay").fadeIn(100);
    $("#ask_image_bg").fadeIn(100);

    var ask = $.grep(asks, function(obj) { return obj.id === ask_id })[0];
    var askImageSegTemplate = _.template($('#ask-image-seg-template').html());
    $("#ask_image_seg").html(askImageSegTemplate({ask:ask, is_left:is_left}));
    $("#ask_image_box").outerHeight() > $(window).height() ? $("#ask_image_seg").css("height","100%") : $("#ask_image_seg").css("height","initial");
  }

  function ask_image_off(){
    enableScroll();
    $("#ask_image_overlay").fadeOut(300);
    $("#ask_image_bg").fadeOut(300);
  }

  $(window).resize(function(){
    $("#ask_image_box").outerHeight() > $(window).height() ? $("#ask_image_seg").css("height","100%") : $("#ask_image_seg").css("height","initial");
    // TODO: 모바일 스크롤 이슈가 있음
  }).resize();

</script>
